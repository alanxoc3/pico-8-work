g_gunvals_raw="|!aa/@1/-2,!aa/@2/-2,!aa/@3/2,!aa/@4/2,13;!aa/@1/-1,!aa/@2/-1,!aa/@3/1,!aa/@4/1,1;|@1,@2,!aa/@3/1,@5;@1,@2,@3,@4;|0x8000,0x8000,0x7fff,0x7fff,@1|0,0,0,0,0,0,0;1,1,1,0,0,0,0;2,2,2,1,0,0,0;3,3,3,1,0,0,0;4,2,2,2,1,0,0;5,5,1,1,1,0,0;6,13,13,5,5,1,0;7,6,13,13,5,1,0;8,8,2,2,2,0,0;9,4,4,4,5,0,0;10,9,4,4,5,5,0;11,3,3,3,3,0,0;12,12,3,1,1,1,0;13,5,5,1,1,1,0;14,13,4,2,2,1,0;15,13,13,5,5,1,0;|ae;0;v,et,oj,ez,spr|ae:eh;ts:es;oe:es;cs:@1;|su;2;ae,|o:@1;a:@2;m:-.05;tp:@3;tr:2;ef:6;s:@4;x=10,;|uu;2;ae,to|o:@1;a:@2;f:46;tp:@3;s:@6;b=@5,;s=@4,b=c,x=10,;|cz;2;ae,to|o:@1;a:@2;f:42;tp:@3;s:@6;b=@5,;s=@4,b=c,x=10,;|ug;2;ae,oh,to|o:@1;a:@2;f:44;tp:@3;s:@6;b=@5,;s=@4,b=c,x=10,;|rw;3;eg,;og,|gl:@1;s:@2;rl:@3;b:@4;x=@1,|hl;3;eg,;og,|o:0;a:0;tt:12;ea:@1;|sn:0;st:0;sp:0;sc:0;ro:0;th:@1;tc:@2;tq:@3;tk:@4;ai:@5;ow:@6;|dq;4;ez,v,spr,oh,nb|o:@1;a:@2;f:@3;u:@4;en:.25;ts:es;s:@5;|m_;4;ez,v,spr,oh,nb|o:@1;a:@2;f:@3;u:@4;ei:.25;ef:-2;ts:es;|lx;4;v,el,tu,ac|o:@1;a:@2;f:@3;u:@4;b:@5;i:@6;|dj;4;v,oh,el,ez,spr,e_|o:@1;a:@2;f:@3;u:@4;m:.2;en:.25;ei:.25;ts:es;x=10,;|hb;2;v,e_,ez,spr,to,et,nb|ts:es;f:41;o:@1;a:@2;en:.25;ei:.25;tp:@3;mh:@4;|un;3;v,el,tu,ac|o:@1;a:@2;s_:@3;b:@4;i:@5;|sd;3;v,el,tu,ac|pa;1;ac,v|ag:@1;b:@2;i:@3;nl:es;|1:well come;2:rock well;3:bub wells;4:not well;|mo;0;ac,e_,|i:@1;o:64;a:1;x=1.5,;x=1,m=-1;|fr;3;to,ez,spr|o:@1;a:@2;f:30;tz:.015;x=5,;|mr;1;tu,et,to,ad,oh|ts:es;eq:@1;ii:1;tp:@2;|pv;2;v,et,oj,ez,spr,e_,to|ae:eh;o:@1;a:@2;ei:.5;ef:4;ni:.99;ny:.99;f:38;tr:2;ts:es;s:@3;b:@4;tp:@5;cs:@6;|uf;0;v,et,oj,ez,spr,e_,to|sl:eh;di:3;s=c,b=c,ho=eh,x=6,;s=@1,b=@2,ho=es,;|pn;0;el,ac|i:@1;x=.5,;b=@2,;|eg;0;,;ln,gu,mc,cf,eo,lb,oz|at:eh;oo:0;s:c;b:c;og:@1;lb:@2;eo:@3;oz:@4;ln:c;mp:c;gu:c;mc:c;cf:c;tp:c;hy:@5;|sh;0;eg,;|ce:thing;|v;0;eg,;ry,|ry:c;|wt;0;eg,;|sl:eh;|el;0;eg,;|o:0;a:0;|gw;0;eg,;og,ll,dl,hr|;|tu;0;el,;|en:.375;ei:.375;|oj;0;et,;|dd;0;et,;|oh;0;oj,;|nb;0;el,|gh:@1;|sf;0;eg,;|sz:c;|r_;0;sf,;|sz:@1;|mm;0;sf,;|lu;0;eg,;|t:0;hr:@1;|e_;0;el,;|p:0;m:0;dl:@1;|to;0;e_,;|ni:1;ny:1;t_:0;tz:0;ll:@1;stop:@2;|ad;0;eg,;li,|eq:sb;nv:0;ii:0;io:0;dp:0;mt:es;li:@1;|ew;0;el,;lt,|om:0;ef:0;se:0;ig:0;pu:eh;lt:@1;|ez;0;ew,;i,|i:c;|pd;0;ew,;i,|uz;0;ew,;i,|dy;0;ew,;i,|cv;0;ew,;i,|pz;0;ew,;i,|sm;0;ew,;i,|re;0;ew,;i,|dg;0;ew,;i,|ac;0;ew,;i,|nn;0;e_,ew,;|f:0;nx:BG_UI;tx:1;tr:1;u:es;sa:es;md:@1;yt:@2;yi:@3;|spr;0;nn,;|i:@1;|ma;0;to,;|hv:@1;|wk;0;to,ew;|wz:@1;|ui;0;eg,;|ay:1;ut:1;gb:eh;wm:@1;gk:@2;|wn;0;ui,;|pi;0;spr,lu;|go:,;ur:1;sy:0;gs:1;me:0;hx:sb;fc:@1;|rj;0;e_,tu;|fz:c;ft:c;fw:c;w_:@1;g_:@1;|ng;1;e_,tu;|ts:@1;oc:c;|et;0;e_,tu;|ts:eh;oc:c;oi:@1;|p:0;m:0|o,p,@1,@2,@3,@4;a,m,@1,@2,@5,@6;|rf;0;e_,tu;|ht:eh;nz:c;fx:@1;|cr;0;spr,ng/eh,v,sh;|lf:c;db:0;hg:0;hu:.75;lw:.75;rj:sb;s:@1;wa:@1;|gq;0;ez,gv,cr,sh;|en:.5;ei:.5;ef:-2;b:%wl|ye;0;ad,ma,et;|fi:1;ms:1;oc:@1;yf:@1;|ab;0;ez,ad,v,nn;|yc:eh;tp:@1;|gz;0;ad,ew,ab;|s:@1;b:@2;rl:@3;yp:@1;wu:@2;gj:@3;ws:@4;poke:20;nh:20;pe:0;|wo;0;ez,cr,sh;og,|yu:eh;lf:@1;en:.5;ei:.5;ef:-3;db:0;hg:.125;hu:.5;lw:.625;sj:BOGUS_SPOT;pw:99|gg;0;eg,;|ln:@1;sj:BOGUS_SPOT;ud:eh;|g;4;eg,v;po,rm|o:0;a:0;yw:2;sl:eh;tt:@1;ea:@2;ol:@3;tw:@4;rm:@5;po:@6;we:@7;,;|@1,o,tt,om;@1,a,ea,ef|rv;2;sm,ad,r_,v|eq:@1;rx:@2;f:1;ii:-.625;i:@3;|lh;0;sm,spr,nn,tu,r_,ad,rf,et,dd,v|tx:2;tr:2;ht:es;ts:es;er:.75;u:es;f:32;nq:@2;nz:$nq;fm:@1;oc:@3;|ex;3;lh,|o:@1;a:@2;eq:@3;tg:eh;lc:.001;wc:0;x=.625,;b=@4,;|ag;2;ew,e_,v|o:@1;a:@2;tx:2;tr:2;uj:@1;hn:30;f:34;s:@3;b:@4;tp:@5;|v,ry;v,eo;v,oz|eg,og;|dw;3;dy,ew,ad,v|eq:@1;color:@2;nd:@3;x=.25,i=@4;|sk;4;dg,to,v,et|o:@1;a:@2;ed:@3;tn:@4;ts:es;ni:.85;ny:.85;s:@5;i:@6;x=.5,;oc:@7;|fo;3;re,spr,v|o:@1;a:@2;u:@3;f:7;s=@4,b=@5,x=3;|ee;3;re,spr,nn,to,r_,rf,dd,et,v,mm|o:@1;a:@2;u:@3;ni:.85;ny:.85;ih:es;iu:.75;hh:.75;hf:.5;f:1;ef:-1;s:@4;b:@5;nz:@6;tp:@8;i:@9;x=.125,;rc=es,b=@5,s=c,oc=@7,;rc=eh,x=.25;ib=2,;|o=64,a=64,s=@8,b=c,i=@1,x=2.5;s=@2,b=@3,i=@4;s=@5,b=@6,i=@7;|fl;0;ac,el,v|o:111;a:123;rr:10;az:10;hi:.5;i:@1;gn:@2;nc:@3;hk:@4;b:@5;|eg,og;ew,lt;to,ll;ee,oi,@1;ex,oi,@1;sk,oi,@1;rf,fx,@2;ad,li;e_,dl;nb,gh;sf,sz;pi,fc;lu,hr;g,rm;|eg,lb|dy,i;cv,i;pz,i;|ez,i;pd,i;uz,i;sm,i;re,i;dg,i;|"
h={}
function fu(ao,fb)
sfx(ao,-1,fb*4,4)
end
function nw(au,e,d)
return au(e)and au(d)and 0 or au(e)and 0xffff or au(d)and 1 or 0
end
function h.aa(e,d)return e+d end
function h.wv(e,d)return e-d end
function is(uk)return uk and 0xffff or 1 end
function hy(e,...)
local hc,nr=tf(...),e or{}
for s=1,#hc do
nr=nr[hc[s]]
if not nr then
break
end
end
return nr
end
function aw()return nw(btn,0,1)end
function ya()return nw(btn,2,3)end
function wh()return nw(btnp,0,1)end
function yn()return nw(btnp,2,3)end
function rb(ao)return ao==0 and 0 or sgn(ao)end
function rg(ao)return flr(ao+.5)end
function n_(pj)return(q"3"-1)*(pj or 1)end
function wy(fk,ck)
return t()%fk<ck
end
function q(o)
return flr(rnd(o))
end
function oy(na)
return na[q(#na)+1]
end
function oa(gc,it)
it=it or{}
for eu,ep in pairs(gc or{})do
if type(ep)=="table"and not ep.pb then
it[eu]=oa(ep)
else
it[eu]=ep
end
end
return it
end
function ah(table,dv,...)
if table and table[dv]then
return table[dv](...)
end
end
function cp(sw,em)
foreach(em,function(t)sw(unpack(t))end)
end
function tm(sw,...)
cp(sw,tf(...))
end
function ld(e)
e.id=e.id or 1
if not e.cn then
e.ap=function()
if e.sl then
e.ib=(e.id%#e)+1
else
e.ib=e.id+1
end
end
e.tb,e.x,e.cn=0,nil,true
oa(e[e.id]or{},e)
ah(e,"s",e)
end
if ah(e,"b",e)then e:ap()end
e.tb+=1/60
if e.x and e.tb>=e.x then
e:ap()
end
if e.ib then
local rp=e.ib
e.id,e.cn,e.ib=rp,nil,nil
ah(e,"rl",e)
return rp>#e or rp<1
end
end
ps=split(g_gunvals_raw,"|")
ds={}
function c()end
function tf(ff,...)
local tj=ps[0+ff]
local em,al=unpack(ds[tj]or{})
if not em then
em,al={},{}
for ab in all(split(tj,";"))do
local eu,ep=dm(ab,":",em)
local ha=function(fj,mg,uw)
return ue(uw or em,mg or eu,fj,al)
end
local af,df={},split(ep,",")
for ab in all(df)do
local eu,ep=dm(ab,"=",af)
if #df==1 then
af=ha(ep)
else
af[eu]=ha(ep,eu,af)
end
end
em[eu]=af
end
ds[tj]={em,al}
end
local im={...}
foreach(im,mk)
foreach(al,function(uo)
local t,eu,au=unpack(uo)
t[eu]=au(im)
end)
return em
end
function dm(na,mu,em)
local nm=split(na,mu)
return nm[#nm-1]or #em+1,nm[#nm]
end
function ue(em,eu,ep,al)
local am=split(ep,"/")
local sq,ca,nk=#am>1
if ord(ep)==33 then
sq,nk=true,deli(am,1)
ca={
em,eu,function()
return h[sub(nk,2)](unpack(am))
end
}
end
for s,o in ipairs(am)do
local iq,rs=sub(o,2),em
if sq then
rs,eu=am,s
end
if ord(o)==64 then
add(al,{
rs,eu,function(gi)
return gi[iq+0]
end
})
elseif ord(o)==36 then
o=function(e,...)
e[iq](e,...)
end
elseif ord(o)==37 then
o=h[iq]
elseif ord(o)==126 then
add(al,{
rs,eu,function()
return em[iq]
end
})
elseif o=="eh"or o=="es"then o=o=="eh"
elseif o=="sb"or o==""then o=nil
elseif o=="c"then o=function()end
end
am[s]=o
end
add(al,ca)
if sq then
return am
else
return am[1]
end
end
function mk(t)
if type(t)=="table"then
t.pb=true
end
return t
end
ak={}
function le(cw,px,...)
local mj,mw=unpack(split(px,"|"))
local fh,ey,fg,pq,us={...},unpack(tf(mj))
h[ey]=function(...)
local hq,im,e={...},oa(fh),{}
if cw then
e=deli(hq,1)
end
for s=1,fg do
add(im,hq[s]or false,s)
end
if not e[ey]then
foreach(pq,function(ic)
if type(ic)~="table"then
ic={ic}
end
e=h[ic[1]](e,unpack(ic,2))
end)
oa(tf(mw,unpack(im)),e)
if not e[ey]then
ak[ey]=ak[ey]or{}
add(ak[ey],e)
end
e.ey,e[ey],e.pause=ey,true,e.pause or{}
foreach(us,function(au)
e.pause[au]=true
end)
end
ah(e,"mp",e)
return e
end
end
function r(...)le(true,...)end
function y(...)le(false,...)end
function an(ey,nk,...)
for e in all(ak[ey])do
ah(e,nk,e,...)
end
end
gm=tf[[1]]
function sr(f,o,a,tx,tr,...)
tx,tr=tx or 1,tr or 1
spr(f,o-tx*4,a-tr*4,tx,tr,...)
end
function sx(e,uh,...)
if e and e.pu then
(uh or sr)(e.f,e.o*8+e.om+e.se,e.a*8+e.ef+e.ig,e.tx,e.tr,e.u,e.sa,...)
end
end
function pl(e)sx(e,pm,e.nx)end
function co(...)
foreach({...},pl)
foreach({...},sx)
end
function wj(eb,te,ek,tl)
tm(rect,
[[2]],eb,te,ek,tl)
end
function cc(flip,si,tu)
si=si-tu*4
if flip then
return tu*8-1+si,-1
else
return si,1
end
end
function pm(f,o,a,tx,tr,u,sa,et)
local hm,lq=cc(u,o,tx)
local dz,hp=cc(sa,a,tr)
local ot=gm[f]
if ot then
for s=1,#ot,4 do
rectfill(
hm+lq*ot[s],
dz+hp*ot[s+1],
hm+lq*ot[s+2],
dz+hp*ot[s+3],
et)
end
end
end
function yo(tj,o,a,uq,ph)
for s=-1,1 do
for ne=-1,1 do
ec(tj,o+s,a+ne,0,BG_UI,BG_UI)
end
end
ec(tj,o,a,0,uq,ph)
end
function ec(tj,o,a,cl,cb,up)
if cl==0 then o-=#tj*2
elseif cl>0 then o-=#tj*4+1 end
tm(print,[[3]],tj,o,a,cb,up)
end
function fd(eb,te,ek,tl)
clip(eb,te,ek+1-flr(eb),tl+1-flr(te))
end
function fq(et)
tm(rectfill,[[4]],et or 0)
end
cg=tf[[5]]
function ij(s)
for l=0,15 do
pal(l,cg[l+1][min(flr(s+1),7)])
end
end
r([[6|7]],function(e)
e.oe=true
e:eo()
end)
y([[8|9]],function(e)
if e.oe then
sfx"3"
end
end,function(e)
e.u=q(2)==0
e.f=oy{36,37,39,40}
end)
y([[10|11]],function(e)
if e.oe then
sfx"3"
end
end,function(e)
local ee=aj()
ok(e,.01,ee.o,ee.a)
end,function(e)
local ee=aj()
if ee.a>e.a+3 then
e:ap()
end
end,function(e)
e.u=q(2)==0
end)
y([[12|13]],function(e)
od+=1
if e.oe then
aq+=1
sfx"3"
end
end,function(e)
local ee=aj()
ok(e,.01,ee.o,ee.a)
end,function(e)
local ee=aj()
if ee.a>e.a+3 then
e:ap()
end
end,function(e)
e.u=q(2)==0
end)
y([[14|15]],function(e)
if e.oe then
sfx"3"
end
end,function(e)
local ee=aj()
ok(e,.01,ee.o,ee.a)
end,function(e)
local ee=aj()
if ee.a>e.a+3 then
e:ap()
end
end,function(e)
e.u=q(2)==0
end)
y([[16|17]],function(e)
ax=max(e.tb/e.x*10,ax)
end)
y([[18|17]],function(e)
ax=min((e.x-e.tb)/e.x*10,ax)
end)
function ej(ey,u,...)
return{f=oy{...},u=u,ey=ey}
end
function gp(em)
for a,ep in pairs(em)do
for o,e in pairs(ep)do
spr(e.f,o*8,a*8,1,1,e.u,e.sa)
end
end
end
function cj(nj,ar,av)
local tq=flr(abs(ar.tq))
local tk=ar.tk
local ai=ar.ai
av=flr(av)
if tk and av+ai>ar.tc.ea then
ar.tc.ea=av+ai
end
for a,ep in pairs(nj)do
if a<av-tq then
nj[a]=nil
end
end
for a=(av-tq),(av+tq)do
if not nj[a]then
nj[a]=ar:ow(a)
end
end
end
function pg(th)
local tk,ow,ns,ai,tq
if th==0 then
tk=true
ow=fa
ns=30
ai=22
tq=18
elseif th>0 and th<4 then
tk=false
ow=mv
ns=14*14+(th-1)*7*7
ai=40
tq=18
else
tk=true
ow=f_
ns=30
ai=40
tq=18
end
local tc=oa(tf([[19]],ns))
local ar=oa(tf([[20]],th,tc,tq,tk,ai,ow))
local ex=h.ag(tc.tt/2,-1.5)
local g=h.g(15,16,0,ex)
return ar,tc,ex,g
end
function of(w,a,eb,ek,as)
for o=eb,ek do
w[o]=ej("ti",false,oy(as))
if q(4)==0 then
h.m_(o+.5,a+.625-1,25,false)
end
end
end
function rk(l,a,ga,op,d_,as,ch,lv)
a=flr(a)
local w={}
local j=l.tc.tt
local a_=l.tc.ea-1
if a>a_ or a<0 then
return{}
end
for o=1,q(2)do
w[q(j)]=ej("yr",false,unpack(ga))
end
w[0]=ej("ti",true,unpack(op))
w[j-1]=ej("ti",false,unpack(op))
if l.th>0 and a>3 and a<a_-4 then
if a%3==0 and q(6)==0 then
if q(2)==0 then
if l.sn<-2 then
w[1]=ej("ti",true,unpack(d_))
l.sp=0
end
else
if l.st<-2 then
w[j-2]=ej("ti",false,unpack(d_))
l.sc=0
end
end
end
if l.ro<-6 and q(10)==0 then
local iy=q(5)
if iy==0 then
of(w,a,j/2-1,j/2,as)
elseif iy==1 then
of(w,a,j/2-3,j/2-2,as)
of(w,a,j/2+1,j/2+2,as)
elseif iy==2 then
of(w,a,j/2-1,j/2+1,as)
elseif iy==3 then
of(w,a,j/2-2,j/2,as)
elseif iy==4 then
of(w,a,j/2-2,j/2+1,as)
end
l.ro=0
end
l.ro-=1
if l.sn>0 then
h.dq(1+.25,a+.5,16,true)
elseif l.sp<-2 and q(12)==0 then
l.sn=q(2)+3
end
if l.st>0 then
h.dq(j-1.25,a+.5,16,false)
elseif l.sc<-2 and q(12)==0 then
l.st=q(2)+3
end
l.sn-=1
l.st-=1
l.sp-=1
l.sc-=1
end
if a==a_-1 or a==a_ then
for o=1,j/2-3 do
w[o]=ej("ti",true,unpack(ch))
w[j-o-1]=ej("ti",false,unpack(ch))
end
w[j/2-2]=ej("ti",false,unpack(op))
w[j/2+1]=ej("ti",true,unpack(op))
w[j/2-2]=ej("ti",false,unpack(op))
w[j/2+1]=ej("ti",true,unpack(op))
end
if a==a_ then
w[j/2-1]=ej("ti",false,unpack(lv))
w[j/2]=ej("ti",true,unpack(lv))
end
return w
end
function lk(l,a,w,rd)
a=flr(a)
local j=l.tc.tt
local p_=25
local a_=l.tc.ea-1
local fn=a_-20
local gr=function()
return q(j-6)+3+.5
end
local o=gr()
if a>=fn or a<=p_ or w[flr(o)]then
return
end
if l.th>=3 and q(rd)==0 then
local ao=q(4)
if ao==0 then
h.sd(o,a+.5,h.cz)
elseif ao==1 then
h.un(o,a+.5,h.ug)
else
h.sd(o,a+.5,h.uu)
end
end
if l.th>=2 and q(rd)==0 then
if l.th>=4 then
h.lx(o,a+.5,oy{131,132,147,148},q(2)==0)
else
h.lx(o,a+.5,13,q(2)==0)
end
end
if l.th>=1 and q(rd)==0 then
if q(4)<2 then
h.hb(o,a+.5)
else
h.sd(o,a+.5,h.su)
end
end
end
function fa(l,a)
if a==0 then
h.pn()
end
if l.th==0 then
if a%10==0 then
h.su(a%20==0 and 3.5 or l.tc.tt-3.5,a+.5,oy{19,23,36,40})
elseif(a+5)%10==0 then
h.su((a+5)%20==0 and l.tc.tt-2.5 or 2.5,a+.5,oy{19,23,36,40})
end
end
return rk(
l,a,
{10,60,62,63},
{12,28},
{11,27},
{8},
{9},
{24}
)
end
function mv(l,a)
local w=rk(
l,a,
{10,60,62,63},
{12,28},
{11,27},
{8},
{9},
{24}
)
lk(l,a,w,15)
return w
end
function f_(l,a)
if a==0 then
h.uf()
end
local w=rk(
l,a,
{10,60,62,63},
{129},
{130,146},
{128},
{162},
{24}
)
lk(l,a,w,15)
return w
end
y([[21|22]],function(e)
if e.u then
e.om=3
else
e.om=-3
end
end)
y([[23|24]])
y([[25|26]],function(e)
if e.a<_.a-_.ea/2-3 then
h.dj(e.o,e.a,e.f,e.u)
e:eo()
end
end,function(e)
if e.a<_.a-_.ea/2 then
ec("!",e.o*8-np(_),1,0,8,2)
end
end)
y([[27|28]])
y([[29|30]],function(e)
od+=1
if e.gd then
aq+=1
sfx(1)
end
end,function(e)
e.gd=true
e:eo()
end)
y([[31|32]],function(e)
if e.a<_.a+_.ea/2+3 then
e.s_(e.o,e.a)
e:eo()
end
end,function(e)
if e.a<_.a+_.ea/2+6 then
ec("!",e.o*8-np(_),128-8-7,0,8,2)
end
end)
y([[33|32]],function(e)
if e.a<_.a+_.ea/2+3 then
e.s_(e.o,e.a)
e:eo()
end
end,function(e)
if e.a<_.a+_.ea/2+6 then
ec("!",e.o*8-np(_),128-8-7,0,10,4)
end
end)
y([[34|35]],function(e)
if e.ag.ex.tg then
e.nl=true
else
e.nl=false
end
if e.nl and btn(3)then
e.ag.ex.lc=0
e.ag.ex.nq=c
e.ag.b=c
e.ag.m=.1
h.rw(1,c,
function()
ev.so+=aq
ev.dx+=od
aq=0
od=0
if ty==4 then
ik.ap()
else
sv((ty or 0)+1)
end
end
)
e:eo()
end
end,function(e)
if e.nl then
local cm=t()%1<.25 and 1 or 0
ec("press down",64,96-cm,0,7,5)
end
end)
lj=tf[[36]]
y([[37|38]],function(e)
if ty>0 then
ec("level "..ty,e.o,e.a,0,7,5)
if lj[ty]then
ec(lj[ty],e.o,e.a+8,0,7,5)
end
end
end)
function ym(hj,ta,td,ie,ip)
ie=ie or 0
ip=ip or 0
if hj and ta then
ok(hj,td,ta.o+ie,ta.a+ip)
end
end
function ok(e,td,o,a)
local er=atan2(o-e.o,a-e.a)
e.t_,e.tz=td*cos(er),td*sin(er)
end
function mf(e,d)
return e and d
and abs(e.o-d.o)<e.en+d.en
and abs(e.a-d.a)<e.ei+d.ei
end
function uc(e,d)
return e and d
and d.o-d.en>=e.o-e.en
and d.o+d.en<=e.o+e.en
and d.a-d.ei>=e.a-e.ei
and d.a+d.ei<=e.a+e.ei
end
function ly(el,mb,td,rz,pf,os,e,lo,ov)
local dn=function(el,hs)
return flr(el-hs),-flr(-(el+hs))-1
end
local ct,lp=dn(el+td,rz)
local pr,ub=dn(mb,pf)
for ne=pr,ub do
if td<0 and ov(ct,ne)then
lo(e,os)
return ct+rz+1,0
elseif td>0 and ov(lp,ne)then
lo(e,os+1)
return lp-rz,0
end
end
return el,td
end
y([[39|40]])
y([[41|42]],function(e)
h.fr(e.o,e.a,e.eq.u)
end)
y([[43|44]],function(e)
h.mr(e)
end,function(e)
local ee=aj()
e.u=sgn(ee.o-e.o)==-1
ok(e,.005,ee.o,ee.a-2)
end,function(e)
if e.oe then
sfx"3"
end
end,function(e)
e.oe=true
e:eo()
end)
y([[45|46]],function(e)
local er=rnd(1)
local nd=12
sfx"14"
e.hd=h.pv(ou.o+cos(er)*nd,ou.a+sin(er)*nd)
end,function(e)
if not e.hd or not e.hd.at then
e.di-=1
if e.di<=0 then
rq.tk=false
e:eo()
else
e.ho=true
e:ap()
end
end
end)
y([[47|48]],function(e)
local lr=0
if t()%2<.25 then lr=sin(t()*4)*2 end
sr(72,64+lr,38,8,2)
rectfill(0,78,125,86,1)
rectfill(0,79,125,85,0)
if t()%2<1.75 then
print("press x or z",64-12*2,80,7)
end
ec("a game for ld #48",64,113-8-8,0,6,1)
end,function(e)
if btn(4)or btn(5)then
ev.dt=t()
e:eo()
rq.tk=false
h.rw(.5,c,function()sv(1)end)
end
end)
r([[49|50]],function(e)
if e.at and e.oo<=0 then
if ld(e)then
e.at=false
end
elseif e.oo>0 then
e.oo-=1
end
end,function(e)
if not e.at then
e:tp()
e:oz()
end
end,function(e)
e.at=nil
end,function(e)
for eu,ep in pairs(ak)do
if e[eu]then del(ep,e)end
end
end,hy)
r[[51|52]]
r[[53|54]]
r[[55|56]]
r[[57|58]]
r[[59|60]]
r[[61|62]]
r[[63|60]]
r[[64|60]]
r[[65|60]]
r([[66|67]],function(e)
if e.a<_.a-_.ea/2-8 then
e:eo()
end
end)
r[[68|69]]
r([[70|71]],function(e)
if e.o+e.p<z.o+.5 then
e.o=z.o+.5
e.p=0
end
if e.o+e.p>z.o+z.tt-.5 then
e.o=z.o+z.tt-.5
e.p=0
end
end)
r([[72|71]],function(e)
if e.a+e.m<z.a+.5 then
e.a=z.a+.5
e.m=0
end
if e.a+e.m>z.a+z.ea-.5 then
e.a=z.a+z.ea-.5
e.m=0
end
end)
r([[73|74]],function(e)
e.t+=1
end)
r([[75|76]],function(e)
e.o+=e.p
e.a+=e.m
end)
r([[77|78]],function(e)
e.p+=e.t_ e.m+=e.tz
e.p*=e.ni e.m*=e.ny
if e.t_==0 and abs(e.p)<.01 then e.p=0 end
if e.tz==0 and abs(e.m)<.01 then e.m=0 end
end,function(e)
e.t_,e.tz,e.p,e.m=0,0,0,0
end)
r([[79|80]],function(e)
local ta=e.eq
if ta then
if ta.at then
e.o,e.a=ta.o+e.nv,ta.a+e.ii
e.p,e.m=ta.p+e.io,ta.m+e.dp
e.nv+=e.io
e.ii+=e.dp
e.se,e.ig=ta.se,ta.ig
if e.mt then
e.u=ta.u
end
else
e.at=false
end
end
end)
r([[81|82]],function(e)
e.se,e.ig=0,0
end)
r[[83|84]]
r[[85|84]]
r[[86|84]]
r[[87|84]]
r[[88|84]]
r[[89|84]]
r[[90|84]]
r[[91|84]]
r[[92|84]]
r[[93|84]]
r([[94|95]],sx,wp,co
)
r([[96|97]],co)
r([[98|99]],function(e,de,ed,tn)
e.p=ed*de
e.m=tn*de
end)
r([[100|101]],function(e)
if e.oo>0 then
e.tz,e.t_=0,0
e.ig=n_()
e.nx=2
else
e.nx=1
end
end)
r([[102|103]],function(e,uy,fs)
if e.oo<=0 then
e.oo=fs
e.ay=max(0,e.ay-uy)
if e.ay==0 then
e.at=false
end
end
end,function(e,ay)
e.ay=min(e.ut,e.ay+ay)
end)
r[[104|60]]
r([[105|106]],function(e)
if e.hx then
e.f=e.hx
else
if e.t%e.me==0 then
e.sy+=1
e.sy%=e.gs
end
e.f=e.go[e.ur+e.sy]or 0xffff
end
end)
r([[107|108]],function(e,d)
if uc(e,d)then
e:fz(d)
elseif mf(e,d)then
e:ft(d)
else
e:fw(d)
end
end)
r[[109|110]]
r([[111|112]],function(e,ua)
local ix={}
local oi=function(p,m)
local af=p+m
local um=function(ci,iz,e,d,el,td)
if td!=0 and el<abs(e[ci]-d[ci])then
if e.ts and d.ts then
local lz=function(l)
if not l.ng then
l[iz]=(e[iz]+d[iz])/2
end
end
lz(e)lz(d)
af=0
end
ix[d][iz]=rb(td)
end
end
foreach(ua,function(d)
if e!=d and(not e.ng or not d.ng)then
local o,a=abs(e.o+p-d.o),abs(e.a+m-d.a)
if o<e.en+d.en and a<e.ei+d.ei then
ix[d]=ix[d]or tf[[113]]
tm(um,[[114]],e,d,o,p,a,m)
end
end
end)
return af
end
e.p,e.m=oi(e.p,0),oi(0,e.m)
for d,i in pairs(ix)do
e:oc(d,i.p,i.m)
end
end)
r([[115|116]],function(e,ov)
local o,p=ly(e.o,e.a,e.p,e.en,e.ei,0,e,e.nz,ov)
local a,m=ly(e.a,e.o,e.m,e.ei,e.en,2,e,e.nz,function(a,o)return ov(o,a)end)
if e.ht then
e.o,e.a,e.p,e.m=o,a,p,m
end
end)
r([[117|118]],function(e)
e.rj=h.wr(e,e.db,e.hg,e.hu,e.lw,c,function(rj,k)
if wf(e,k)then
du(e)
if wd(e,k)then
e:lf()
end
else
if gx()==e then
du()
end
end
end)
end)
r[[119|120]]
r([[121|122]],function(e,no)
if no!=e.eq then
ah(no,"hv",no,e.fi,is(e.u),0)
du(no)
if e.eq then
ah(e.eq,"hv",e.eq,-e.ms,is(e.u),0)
end
end
end
)
r([[123|124]],function(e)
if e==e.eq.ab then e.eq.ab=nil end
end)
r([[125|126]],function(e)
e.u=e.eq.u
e.om=e.u and e.cy or-e.cy
yh(e.pe)
end,function(e)
e.io=is(e.u)*e.nh/e.x/FPS
wb()
end,function(e)
e.io,e.nv=0,e.u and-e.nh or e.nh
end,function(e)
e.io=-is(e.u)*e.nh/e.x/FPS/2
end)
r([[127|128]],function(e)
if wq(e.pw)then
e:eo()
h.yd(sg,e.f,e.sj)
pause"gy"
yg"1"
else
fu(2,6)
end
end)
r([[129|130]],function(e)
if yl(e.sj)==e.ud then
e:oz()
end
end)
function pk(g,nu,ox,mn)
local nt=g.tw and(g.tw[nu]+g.tw[mn]/8)or 0
local tv=g[nu]
local mx=g[ox]
local i_=z[ox]/2-mx/2
local ia=z[nu]+z[ox]/2
local ol=rg(g.ol*8)/8
if nt<tv-ol then tv=nt+ol end
if nt>tv+ol then tv=nt-ol end
if tv<ia-i_ then tv=ia-i_ end
if tv>ia+i_ then tv=ia+i_ end
if z[ox]<=g[ox]then tv=ia end
g[nu]=tv
end
function ww(o,a,l)
pset(o*8,a*8,l)
end
function dr(eb,te,ek,tl,et)
line(eb*8,te*8,ek*8,tl*8,et)
end
function wi(eb,te,ek,tl,et)
rectfill(eb*8,te*8,ek*8,tl*8,et)
end
function ys(pt,mz,fp,ux,...)
map(pt,mz,fp*8,ux*8,...)
end
function u_(o,a,rt,et)
circfill(o*8,a*8,rt*8,et)
end
function gt(o,a,rt,et)
circ(o*8,a*8,rt*8,et)
end
y([[131|132]],
function(e)
if e.tw and not e.tw.at then
e.tw=nil
end
tm(pk,[[133]],e)
end,function(e)
if e.tw then
e.o,e.a=e.tw.o,e.tw.a
e.ce=e.tw.ce
end
e:rm()
end,function(e,k)
if not k or k.sh then
e.tw=k
end
end)
y([[134|135]],function(e)
local eb,te,ek,tl=e.o+e.p,e.a+e.m,e.rx.uj,e.rx.a-e.rx.hn
dr(eb,te,ek,tl,2)
dr(eb-.125,te,ek-.125,tl,2)
end)
r([[136|137]],function(e)
if btnp(4)then
e:nq()
end
local he=.1
if btn(3)or btn(2)then
he=.2
end
if e.tg and aw()!=0 then
e.u=aw()==-1
end
local ri=e.eq.hn
e.er=atan2(cos(e.er),sin(e.er)+he)
e.nv=rg(ri*cos(e.er)*8)/8
e.ii=rg(ri*sin(e.er)*8-ri*8)/8
if e.tg then
e.f=32
else
e.f=34
end
end,function(e)
if e.tg then
sfx"25"
e.tg=false
e.ee=h.ee(e.o,e.a,e.u)
h.dw(e.ee,2,1)
end
end,function(e,k)
if e.tg then
l_(e,k)
end
if k.oj then
e:nq()
end
end)
y([[138|139]],function(e)
if e.tg and aw()!=0 then
e.er+=aw()*e.lc
end
if btn(5)and e.tg and ob:nc()then
ob:hk()
local ed,tn=lg(e.u)
h.sk(e.o,e.a,ed,tn)
end
if e.tg then
ob:gn()
end
e:fm()
end)
y([[140|141]],function(e)
e.ex=h.ex(e.o,e.a,e)
e.rv=h.rv(e.ex,e)
end,function(e)
e.m=.1
local h_=z.a+z.ea-1.75
if e.a+e.m>=h_ then
e.a=h_-e.m
if not e.dk then
e.dk=h.pa(e)
end
end
end,function(e)
e.rv:eo()
e.ex:eo()
e.dk:eo()
end)
function fe()
music(0,2000)
tm(an,[[142]])
ev.ml=flr(t()-ev.dt)
h.hl(.5,c,c)
ax=8
end
function pc()
tm(an,[[143]])
end
function uv()
ij(ax)
sr(134,64,36,10,8)
ec("you win!",64,68,0,11,1)
c_(89-4)
ec("@alanxoc3       code & sfx   ",64,118-8-8,0,6,1)
ec("@thegreatcadet  gfx & sfx    ",64,118-8,0,6,1)
ec("@codecodymorgan gfx & design ",64,118,0,6,1)
end
function my(i)
local py=flr(i%60)
local ul=flr(i/60)
return ""..ul.."M "..py.."S"
end
function c_(a)
rect(-1,a-7,128,a+12,1)
ec("time : "..my(ev.ml),6,a-4,-1,15,2)
ec("shots: "..ev.hz,6,a+4,-1,12,1)
ec("died : "..ev.hw,70,a-4,-1,8,2)
ec("coins: "..ev.so.."/"..ev.dx,70,a+4,-1,10,4)
end
function l_(e,k)
if k.hb then
k:mh()
end
if k.ae then
k:cs()
end
end
function lg(u)
local ed=0
local tn=0
if btn(1)then
ed=1
elseif btn(0)then
ed=-1
end
if btn(2)then
tn=-1
elseif btn(3)then
tn=1
end
if ed==0 and tn==0 then
ed=is(u)
end
return ed,tn
end
y([[144|145]],function(e)
gt(e.o,e.a,e.nd*e.tb*6,e.color or 2)
end)
y([[146|147]],function(e)
if ty!=0 then
ev.hz+=1
end
sfx"2"
local er=atan2(e.ed,e.tn)
e.p=cos(er)*.8
e.m=sin(er)*.8+.2
end,function(e)
u_(e.o,e.a,1/(1.5+e.tb*16),12)
end,function(e,k)
if k.ae or k.dj then
local o_=rb(e.p)
if o_==0 then
o_=rb(k.o-e.o)
if o_==0 then
o_=q(2)==0 and-1 or 1
end
end
k.p+=o_*.05
h.dw(k,12,1)
e:eo()
end
end)
y([[148|149]],function(e)
h.rw(1,c,da)
end,function(e)
e.om=n_()
e.ef=n_()
end)
y([[150|151]],function(e)
e.m=-e.iu
end,function(e)
if aw()!=0 then
e.u=aw()==-1
end
if not e.ih then
if e.il and btn(0)then
e.f=6 e.ef=-1 e.u=false
elseif e.iw and btn(1)then
e.f=6 e.ef=-1 e.u=true
else
e.f=1 e.ef=-1
end
else
if e.t_==0 then
e.f=2 e.ef=-1
elseif e.t_!=0 then
if e.tb*60%16<4 then
e.f=3 e.ef=-2
elseif e.tb*60%16<8 then
e.f=2 e.ef=-1
elseif e.tb*60%16<12 then
e.f=4 e.ef=-1
else
e.f=2 e.ef=-1
end
end
end
if not e.rc then
e.t_=aw()*.05
e.tz=.04
if not e.ih then
if e.il and btn(0)then
e.tz=.0117
elseif e.iw and btn(1)then
e.tz=.0117
end
end
if btnp(4)then
if e.ih then
e.m=-e.iu
sfx"25"
elseif e.il then
e.p=e.hh
e.m=(btn(3)and 1 or-1)*e.hf
sfx"25"
elseif e.iw then
e.p=-e.hh
e.m=(btn(3)and 1 or-1)*e.hf
sfx"25"
end
end
if btnp(5)and ob:nc()then
ed,tn=lg(e.u)
if ed!=0 and e.il then
ed=1
elseif ed!=0 and e.iw then
ed=-1
end
ob:hk()
h.sk(e.o,e.a,ed,tn)
local er=atan2(-ed,-tn)
e.p+=e.iu*cos(er)
e.m+=e.iu*sin(er)
e.t_,e.tz=0,0
e:ap()
end
end
local pp=_.a+_.ea/2
if e.a>_.a+_.ea/2 then
rh=4
if e.a>pp+2 then
e:eo()
end
end
local rn=_.a-_.ea/2+1.5
if e.a<rn then
e.m+=.05
if e.a<rn-1.5 then
rh=4
end
if e.a<rn-3 then
e:eo()
end
end
e.ih=false
if not e.rc then
e.il=false
e.iw=false
end
end,function(e,os)
if os==3 then e.ih=true end
if os==0 then
e.il=true
end
if os==1 then
e.iw=true
end
end,function(e,k)
l_(e,k)
if k.ae then
e.m=-e.iu/2
end
if k.lh then
e.cu=true
e:eo()
sfx"26"
k.tg=true
k.u=e.u
elseif k.oh then
e:eo()
end
end,function(e)
if not e.cu then
sfx"15"
h.fo(e.o,e.a,e.u)
if ty!=0 then
ev.hw+=1
end
end
end,function(e)
e:md()
end)
poke(0x5f5c,15)
poke(0x5f5d,15)
menuitem(1,"restart",function()
extcmd"reset"
end)
aq=0
od=0
ev={
dt=0,
so=0,
dx=0,
hw=0,
hz=0,
}
function _init()
music(0,3000)
ik=tf([[152]],cq,
cx,fy,mi,
fe,pc,uv,function()sfx(63)end
)
end
function aj()
if ou.ex.tg then
return ou.ex
else
return ou.ex.ee
end
end
function sv(ss)
if(ty==nil or ty<4)and ss==4 then
music(16,2000)
end
tm(an,[[142]])
ty=ss
oq={}
rq,z,ou,_=pg(ss)
ax=8
ob=h.fl()
h.hl(.5,c,c)
if ss>0 then
h.mo()
end
end
function da()
aq=0
od=0
local fv=0
sv(ty or fv)
end
y([[153|154]],function(e)
local la=3
local on=e.rr*la
local ra=e.az*la
local ru=e.a-1
local ir=e.a+2
local dh=12
local nf=1
if t()%1<.25 then
if e:nc()then
dh=6
nf=5
end
end
rect(e.o-on+1,ru,e.o-on+1,ir,nf)
rect(e.o,ru,e.o,ir,nf)
if ra>0 then
rectfill(e.o-on+1+(on-ra),ru,e.o,ir,dh)
rectfill(e.o-on+1+(on-ra),ir,e.o,ir,nf)
end
end,function(e)
if not e.iv then
e.az=min(e.rr,e.az+e.hi)
end
end,function(e)
return not e.iv and e.az==e.rr
end,function(e)
if e:nc()then
e.iv=true
end
end,function(e)
if e.iv then
e.az=max(0,e.az-e.hi*3)
if e.az==0 then
e.iv=false
end
end
end)
function cx(e)
ev.so=0
aq=0
od=0
da()
end
function fy(e)
cj(oq,rq,ou.a+3)
rh=0
tm(
an,[[155]],ak["et"],
function(o,a)
return o>=z.o and o<z.o+z.tt and
a>=z.a and a<z.a+z.ea and
oq[flr(a)]and oq[flr(a)][flr(o)]and
oq[flr(a)][flr(o)].ey=="ti"
end
)
tm(an,[[156]])
end
function gf(t)
if t then
for n=2,#t do
local s=n
while s>1 and t[s].a<t[s-1].a do
t[s],t[s-1]=t[s-1],t[s]
s=s-1
end
end
end
end
function mi(e)
ij(ax)
ge(_,8+rh*sin(t()*8)/8,7.5)
lm(_)
if wx then
if wg==5 then sg.nx=SL_UI end
sg.i(sg)
end
camera()
an("ac","i")
spr(41,14,120)
ec(":"..(ev.so+aq),21,121,-1,10,5)
end
function cq(e)
local dc=8+cos(e.tb/e.x)*4-4
ij(dc)
camera(dc>1 and n_())
sr(108,e.o,e.a,4,2)
ij"0"
camera()
end
function _update60()
ld(ik)
end
function _draw()
cls()
ah(ik,"i",ik)
end
function np(g)
return(g.o-g.ie-8)*8
end
function mq(g)
return(g.a-g.ip-8)*8
end
function lm(g)
camera(np(g),mq(g))
end
function ge(g,o,a)
if g then
local en=o-g.tt/2
local ei=a-g.ea/2
g.ie=-(16-g.tt)/2+en
g.ip=-(16-g.ea)/2+ei
local eb,ek=en*8+4,(en+g.tt)*8-5
local te,tl=ei*8+4,(ei+g.ea)*8-5
lm(g)
fd(eb,te,ek,tl)
fq(z.l)
tm(an,[[157]])
gp(oq)
gf(ak.ez)
tm(an,[[158]])
clip()
camera()
end
end