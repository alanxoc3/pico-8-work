pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
-- mod test
-- by alan morgan
function _init()
   g_x, g_y = 0, 0
	pl_x = 4
	pl_y = 4
	load_view(0, 0, 30, 18, 4, 10)
	center_view(pl_x, pl_y)
end

function _update60()
	local dx = 0
	local dy = 0

	if btn(0) then dx = -.1 end
	if btn(1) then dx = .1 end
	if btn(2) then dy = -.1 end
	if btn(3) then dy = .1 end

	pl_x += dx
	pl_y += dy

	update_view(pl_x, pl_y)
end

function _draw()
	cls()
	print('pico project!', 20, 20, 7)
	scr_map(0, 0, 0, 0, 32, 32)

	scr_rect(pl_x, pl_y, pl_x+1, pl_y+1, 8)
end
-->8
function load_view(room_x, room_y, room_w, room_h, scr1, scr2)
	g_rx, g_ry, g_rw, g_rh, g_s1, g_s2 = room_x, room_y, room_w, room_h, scr1, scr2
end

function center_view(x, y)
	g_x, g_y = x - 8, y - 8
	update_view(x, y)
end

function update_view_helper(pc, gc, rc, rd)
	-- order matters here.
	-- this helper shaved over 30 tokens.
	if pc < gc + g_s1 then gc = pc - g_s1 end
	if pc > gc + g_s2 then gc = pc - g_s2 end
	if gc < rc        then gc = rc end
	if gc+16 > rc+rd  then gc = rc+rd-16 end
	if rd < 16        then gc = rd/2 - 8 + rc end
	return gc
end

-- example usage: update_view
function update_view(p_x, p_y)
	g_x, g_y = update_view_helper(p_x, g_x, g_rx, g_rw), update_view_helper(p_y, g_y, g_ry, g_rh)
end

-- i made this function, because i had duplicate logic of:
-- times the position by 8 and subtract from the scr_y pos.
-- for multiple sprites.
function scr_spr(ind, x, y, w, h, xflip, yflip)
	if not w then w = 1 end
	if not h then h = 1 end
	spr(ind, (x - g_x)*8, (y - g_y)*8, w, h, xflip, yflip)
end

-- some utility functions
function scr_x(x) return (x-g_x)*8 end
function scr_y(y) return (y-g_y)*8 end

function scr_spr(ind, x, y, w, h, xflip, yflip)
	spr(ind, scr_x(x), scr_y(y), w or 1, h or 1, xflip, yflip)
end

function scr_rect(x1, y1, x2, y2, col)
	rect(scr_x(x1),scr_y(y1),scr_x(x2),scr_y(y2),col)
end

function scr_rectfill(x1, y1, x2, y2, col)
	rectfill(scr_x(x1),scr_y(y1),scr_x(x2),scr_y(y2),col)
end

function scr_print(txt, x, y, col)
	print(txt, scr_x(x),scr_y(y), col)
end

function scr_mirrored(ind, x, y, w, h)
	scr_spr(ind, x, y, w, h)
	scr_spr(ind, x+w, y, w, h, true)
end

function scr_map(cel_x, cel_y, sx, sy, cel_w, cel_h)
	map(cel_x, cel_y, scr_x(sx), scr_y(sy), cel_w, cel_h)
end

function scr_clip(x1, y1, x2, y2)
	clip(scr_x(x1), scr_y(y1), (x2-x1)*8, (x2-x1)*8)
end

function scr_circ(x, y, r, col)
	circfill(scr_x(x),scr_y(y), r*8, col)
end
__gfx__
00000000555555555556666666666666666666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000555555555555566666666666666666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700555555555555555555555666666666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000555555555588555555555556666666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000555555555888855555555555566666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700555555555888855555555555566666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000555555555588555555555555566666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000555555555555555555599999966666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000555555555555555559999999996666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000555555555555555999999999996666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000555555555555999999999999996666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000999559999999999999999988886666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000999999999999999999999888886666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000999999999999999999998888886666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000999999999999999999998888888666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000999999999999999998888888888866660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000999999999999999998888888888866660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000999999999999999988888888888866660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000999999999999999888888888888866660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000999999999999999888888888888866660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000999999999999999888888888888866660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000999999999999998888888888888866660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000999999999999988888888888888666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000999999999999988888888888666666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000999999999999988888888888666666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000999999999999988888888888666666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000999999999999998888888886666666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000999999999999998888888886666666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000999999999999998888888866666666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000999999966666666888888666666666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000996666666666666666666666666666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000666666666666666666666666666666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0102030401020304010203040102030401020304010203040102030400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1112131411121314111213141112131411121314111213141112131400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2122232421222324212223242122232421222324212223242122232400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3132333431323334313233343132333431323334313233343132333400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0102030401020304010203040102030401020304010203040102030400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1112131411121314111213141112131411121314111213141112131400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2122232421222324212223242122232421222324212223242122232400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3132333431323334313233343132333431323334313233343132333400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0102030401020304010203040102030401020304010203040102030400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1112131411121314111213141112131411121314111213141112131400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2122232421222324212223242122232421222324212223242122232400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3132333431323334313233343132333431323334313233343132333400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0102030401020304010203040102030401020304010203040102030400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1112131411121314111213141112131411121314111213141112131400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2122232421222324212223242122232421222324212223242122232400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3132333431323334313233343132333431323334313233343132333400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0102030401020304010203040102030401020304010203040102030400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1112131411121314111213141112131411121314111213141112131400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2122232421222324212223242122232421222324212223242122232400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3132333431323334313233343132333431323334313233343132333400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0102030401020304010203040102030401020304010203040102030400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1112131411121314111213141112131411121314111213141112131400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2122232421222324212223242122232421222324212223242122232400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3132333431323334313233343132333431323334313233343132333400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
010f0000212502325029250262502623026220262102620026200262002b0702b0502b0302b0202b0100000000000000000000000000000000000000000000000000000000000000000000000000000000000000
